#
# Mitraillette configuration file for BELENOS (V122019)
#

#unchained jobs or not?
MIT_UNCHAINED_JOB="__mit_unchained_job__"

# where the io_serv tools are
IO_SERV_TOOLS_DIR=$MIT_INSTALL_DIR/io_serv_tools

# Where to store the output files
WORKDIR=${SCRATCH}

# Where to put your modified job* files, i.e. the chain-files
# MITRA_HOME is defined in mitraillette.x as your pwd

if [ "x$STARTTIME" != "x" ]
then
TMP_LOC=$SCRATCH/tmp/mitraille.${SLURM_JOBID}.${STARTTIME}
else
TMP_LOC=$SCRATCH/tmp/mitraille.${SLURM_JOBID}
fi
mkdir -p $TMP_LOC
# Location of input data: cycle independent data
# FILE_PATH_DBASE.. for databases to use conf 923.
# FILE_PATH for other files.
INPUTFILES_HOME=/perm/soa1/mitraillette/mitraillette-data/
INPUTFILES_WORKDIR=/perm/soa1/mitraillette/mitraillette-data/
# - for regular validation
FILE_PATH=${INPUTFILES_HOME}/anal_mitraille
FILE_PATH_DILA=${INPUTFILES_HOME}/dila
FILE_PATH_DBASE1=${INPUTFILES_HOME}/const/923N/RELIEF_G/GTOPT030
FILE_PATH_DBASE2=${INPUTFILES_HOME}/const/923N/SURFACE_G/version2/i3e
FILE_PATH_DBASE3=${INPUTFILES_HOME}/const/923N/N108/i3e
FILE_PATH_DBASE5=${INPUTFILES_HOME}/const/923N/SURFACE_L/EUROPEb_v1/i3e
FILE_PATH_DBASE6=${INPUTFILES_HOME}/const/923N/CLIM_G/version2/i3e
FILE_PATH_DBASE8=${INPUTFILES_HOME}/const/923N/CLIM_G/ozone/ascii
FILE_PATH_DBASE9=${INPUTFILES_HOME}/const/923N/CLIM_G/aerosols/ascii
FILE_PATH_IFS=${INPUTFILES_HOME}/ifs-tco399
# - for scientific tests
FILE_PATH_EXPS=${INPUTFILES_WORKDIR}

# Location of input data: cycle dependent data
# FILE_PATH_RRTMCST for constant files used in the RRTM radiation scheme.
# FILE_PATH_ECOCLIMAP for "ecoclimap" files used in SURFEX.
# FILE_PATH_PGD for databases to make PGD files.
#FILE_PATH_RRTMCST=${INPUTFILES_HOME}/const/rrtm_cst/V02
FILE_PATH_RRTMCST=${INPUTFILES_HOME}/const/rrtm_cst_cy47R1   ##netcdf files since cy47t1r1.v03 (= pre-cy48 v3)
FILE_PATH_ECOCLIMAP=${INPUTFILES_HOME}/const/ecoclimap/V8.0
FILE_PATH_PGD=${INPUTFILES_HOME}/const/mesonh/PGD/V02

# Definition of cp/ecp for files and namelists
# - for files which are on the local machine.
CP="/usr/bin/cp"    # 'ln -s' is forbidden for this command
# - for files which may be either on a storage machine or on the local machine.
## ECP="/bin/cp"   # 'ln -s' is allowed for this command
ECP="ln -s"   # 'ln -s' is allowed for this command

# io_serv tools
# LFITOOLS
EXEC_IFSAUX_LFITOOLS=/perm/soa1/mitraille/io_serv_tools/lfitools_cy50t1rc.OMPIIFC2302DP2.y/lfitools
# the following two need to export var LFITOOLS (done below)
# IO POLL, recombining fields after io_serv
IOPOLL="$IO_SERV_TOOLS_DIR/io_poll"
# LFI copy, with repacking
LFICP="$IO_SERV_TOOLS_DIR/lfi_copy -pack -force"
# LFI move, with repacking
LFIMV="$IO_SERV_TOOLS_DIR/lfi_move -pack -force"

# Batch and MPI launch definitions
SUBMIT=/usr/local/bin/sbatch
MPILAUNCH="time /home/sor/install/mpiauto/mpiauto --verbose --wrap-stdeo --wrap -np $MPI_TASKS -nnp $MPITASKS_PER_NODE --"

# xpnam
XPNAM=/perm/soa1/xpnam/bin/xpnam

# Machine-depending namelist variables
LOPT_SCALAR=.TRUE.
MBX_SIZE=1024000000
NCOMBFLEN=1800000
MP_TYPE=2

# BULL specific environment variables
set -x
ulimit -s unlimited
module purge

#Oper settings for Intel MKL library
# variables for perfect reproductibilty for some oper conf.
export MKL_CBWR=AUTO,STRICT
export MKL_DEBUG_CPU_TYPE=5

export OMP_STACKSIZE=4G
export KMP_STACKSIZE=4G
export KMP_MONITOR_STACKSIZE=1G
export EC_MPI_ATEXIT=0
export EC_PROFILE_HEAP=0
export MPIAUTOCONFIG=mpiauto.TIME.conf
export OMP_NUM_THREADS=__nb_threads__
export DR_HOOK=1
export DR_HOOK_IGNORE_SIGNALS=-1
export DR_HOOK_SILENT=1
export DR_HOOK_OPT=prof
export MPL_MBX_SIZE=2048000000
export LFITOOLS=$EXEC_IFSAUX_LFITOOLS
export KMP_AFFINITY="verbose,compact,granularity=fine"
#export KMP_AFFINITY="compact,granularity=fine"
export KMP_BLOCKTIME=12
export OMP_WAIT_POLICY=ACTIVE


export ZOPT="" # optimisation options when running.
export EC_MEMINFO=0

